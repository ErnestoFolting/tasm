PRINTZ MACRO ZINPUT
LOCAL M1, M2, M3
MOV BX, ZINPUT
OR BX,BX 
JNS M1
MOV AL, '-'
INT 29H
NEG BX

M1:
MOV AX,BX 
XOR CX, CX 
MOV BX, 10

M2:
XOR DX,DX
DIV BX 
ADD DL, '0'
PUSH DX
INC CX 
TEST AX,AX 
JNZ M2 

M3:
POP AX 
INT 29H
LOOP M3 
ENDM

STSEG SEGMENT PARA STACK "STACK"
DB 64 DUP("STACK")
STSEG ENDS

DSEG SEGMENT PARA PUBLIC "DATA"
STARTMESSAGE DB 'HI, INPUT A NUMBER FROM -32768 T0 32767, MAX - 6 SYMBOLS: $'
ERRORMESSAGE DB 'OOOPS, WRONG DATA$'
FRACMESSAGE DB ' REMNANT PART: $'
RESULTMESSAGE DB ' Z = $'
DIVTOMESSAGE DB ' DIV TO: $'

X DW 0
Z DW 0
EXP1PART1 DW 0
EXP1PART2 DW 0
EXP3PART1 DW 0
EXP3PART2 DW 0
INTGLOBAL DW 0
REMNANTGLOBAL DW 0

CURRENTDIGIT DW 0
CURRENTPART DW 0 
FRACTIONALRESULT DW 0
ZFRAC DW 0

CONVERTATIONCORRECT DW 1

XSTRING DB 7, 0, 7 DUP(0DH)

MINNUM EQU -32768
TOCOMP EQU 0

DSEG ENDS

CSEG SEGMENT PARA PUBLIC "CODE"
.386

ASSUME CS:CSEG, DS:DSEG, SS:STSEG

MAIN PROC FAR

PUSH DS
XOR AX,AX 
PUSH AX
;INITIALIZATION OF DS
MOV AX,DSEG
MOV DS,AX

LEA DX, STARTMESSAGE
MOV AH,9H
INT 21H

;INPUT SYMBOLS
MOV AH, 0AH
LEA DX, XSTRING
INT 21H
CALL PRINTNEWLINE 

CALL CONVERTATION
CMP CONVERTATIONCORRECT, 1
JNE INCORRECT
CALL CALCULATE 
INCORRECT:
RET

MAIN ENDP

PRINTNEWLINE PROC NEAR
MOV AL, 0AH
INT 29H
RET
PRINTNEWLINE ENDP

PRINTERROR PROC NEAR
LEA DX, ERRORMESSAGE
MOV AH, 9H
INT 21H 
CALL PRINTNEWLINE 
RET 
PRINTERROR ENDP 

CONVERTATION PROC NEAR
;CONVERT TO NUMBER
LEA SI, XSTRING +2
CMP BYTE PTR [SI], "-"
JNE A1
INC SI

A1:
XOR AX,AX
MOV BX,10 

A2:
MOV CL, [SI]
CMP CL, 0DH
JZ NEGATIVE

CMP CL,'0'
JB ERROR
CMP CL, '9'
JA ERROR

SUB CL, '0'
IMUL BX
JO ERROR
ADD AX, CX
JO MIN
INC SI 
JMP A2
ERROR:
CALL PRINTERROR 
MOV CONVERTATIONCORRECT, 0
RET 
MIN:
CMP AX, MINNUM
JNE ERROR 
CMP BYTE PTR [XSTRING + 2], "-"
JNE ERROR 
NEGATIVE:
CMP BYTE PTR [XSTRING+2], "-"
JNE A3
NEG AX
A3:
MOV X,AX 
RET 
CONVERTATION ENDP

CALCULATE PROC NEAR
CMP X, 0
JE EXPRESSION2
JL EXPRESSION1
JG EXPRESSION3

EXPRESSION1:
CALL CALCULATE1
RET
EXPRESSION2:
CALL CALCULATE2
RET 
EXPRESSION3:
CALL CALCULATE3
RET 
CALCULATE ENDP 




CALCULATE1 PROC NEAR 
;x^3-7x
MOV AX,X
IMUL X
JO ERR1
IMUL X
JO ERR1
MOV BX,X
IMUL BX, 7
JO ERR1
SUB AX, BX 
JO ERR1 
MOV EXP1PART1, AX

;X^2 + 17
MOV AX,X 
IMUL X
JO ERR1
ADD AX, 17
JO ERR1
MOV EXP1PART2, AX

XOR DX,DX
MOV AX, EXP1PART1
MOV BX, EXP1PART2
CWD
IDIV BX 
JO ERR1
MOV INTGLOBAL, AX 
MOV REMNANTGLOBAL, DX 


LEA DX, RESULTMESSAGE
MOV AH, 9H
INT 21H

MOV AX, INTGLOBAL 
MOV Z, AX 
PRINTZ Z

MOV AX, REMNANTGLOBAL
MOV ZFRAC, AX 
CALL PRINTZFRAC

LEA DX, DIVTOMESSAGE
MOV AH, 9H
INT 21H
MOV AX, EXP1PART2
MOV Z, AX
PRINTZ Z
CALL PRINTNEWLINE

RET
ERR1:
CALL PRINTERROR 
RET 
CALCULATE1 ENDP




CALCULATE2 PROC NEAR 
MOV Z, 127
PRINTZ Z
RET 
CALCULATE2 ENDP




CALCULATE3 PROC NEAR 
;x^2+8x-7
MOV AX,X
IMUL X
JO ERR3 
MOV BX,X
IMUL BX,8
JO ERR3
ADD AX, BX 
JO ERR3
SUB AX, 7
JO ERR3
MOV EXP3PART1, AX 


;x^3
MOV AX,X
IMUL X
JO ERR3
IMUL X
JO ERR3
MOV EXP3PART2, AX

XOR DX,DX
MOV AX, EXP3PART1
MOV BX, EXP3PART2
CWD
IDIV BX 
JO ERR3
MOV INTGLOBAL, AX 
MOV REMNANTGLOBAL, DX 

LEA DX, RESULTMESSAGE
MOV AH, 9H
INT 21H

MOV AX, INTGLOBAL 
MOV Z, AX 
PRINTZ Z

MOV AX, REMNANTGLOBAL
MOV ZFRAC, AX 
CALL PRINTZFRAC


LEA DX, DIVTOMESSAGE
MOV AH, 9H
INT 21H
MOV AX, EXP3PART2
MOV Z, AX
PRINTZ Z
CALL PRINTNEWLINE

RET
ERR3:
CALL PRINTERROR 
RET 
CALCULATE3 ENDP


PRINTZFRAC PROC NEAR
LEA DX, FRACMESSAGE
MOV AH, 9H
INT 21H
MOV BX, ZFRAC
OR BX,BX 
JNS M4
MOV AL, '-'
INT 29H
NEG BX

M4:
MOV AX,BX 
XOR CX, CX 
MOV BX, 10

M5:
XOR DX,DX
DIV BX 
ADD DL, '0'
PUSH DX
INC CX 
TEST AX,AX 
JNZ M5 

M6:
POP AX 
INT 29H
LOOP M6 
RET 
PRINTZFRAC ENDP

CSEG ENDS
END MAIN